[gd_scene load_steps=17 format=2]

[ext_resource path="res://scenes/OS/Taskbar.tscn" type="PackedScene" id=1]
[ext_resource path="res://scenes/OS/Shortcut.tscn" type="PackedScene" id=2]
[ext_resource path="res://icon.png" type="Texture" id=3]
[ext_resource path="res://scenes/OS/Windows.gd" type="Script" id=4]
[ext_resource path="res://scenes/minigames/ReportMinigame.tscn" type="PackedScene" id=5]
[ext_resource path="res://scenes/OS/Window.tscn" type="PackedScene" id=6]
[ext_resource path="res://scenes/minigames/MinigameSpawner.tscn" type="PackedScene" id=7]
[ext_resource path="res://scenes/programs/Email.tscn" type="PackedScene" id=8]
[ext_resource path="res://assets/Images/wallpaper.png" type="Texture" id=9]
[ext_resource path="res://scenes/programs/Notepad.tscn" type="PackedScene" id=10]
[ext_resource path="res://scenes/Username.gd" type="Script" id=11]
[ext_resource path="res://scenes/OS/Ritual.gd" type="Script" id=12]
[ext_resource path="res://scenes/Main.gd" type="Script" id=13]
[ext_resource path="res://assets/Images/game_over.png" type="Texture" id=14]

[sub_resource type="Shader" id=1]
code = "/*
    Glitch Effect Shader by Yui Kinomoto @arlez80

    MIT License
*/

shader_type canvas_item;

// 振動の強さ
uniform float shake_power = 0.03;
// 振動率
uniform float shake_rate : hint_range( 0.0, 1.0 ) = 0.2;
// 振動速度
uniform float shake_speed = 5.0;
// 振動ブロックサイズ
uniform float shake_block_size = 30.5;
// 色の分離率
uniform float shake_color_rate : hint_range( 0.0, 1.0 ) = 0.01;

float random( float seed )
{
    return fract( 543.2543 * sin( dot( vec2( seed, seed ), vec2( 3525.46, -54.3415 ) ) ) );
}

void fragment( )
{
    float enable_shift = float(
        random( trunc( TIME * shake_speed ) )
    <    shake_rate
    );

    vec2 fixed_uv = SCREEN_UV;
    fixed_uv.x += (
        random(
            ( trunc( SCREEN_UV.y * shake_block_size ) / shake_block_size )
        +    TIME
        ) - 0.5
    ) * shake_power * enable_shift;

    vec4 pixel_color = textureLod( SCREEN_TEXTURE, fixed_uv, 0.0 );
    pixel_color.r = mix(
        pixel_color.r
    ,    textureLod( SCREEN_TEXTURE, fixed_uv + vec2( shake_color_rate, 0.0 ), 0.0 ).r
    ,    enable_shift
    );
    pixel_color.b = mix(
        pixel_color.b
    ,    textureLod( SCREEN_TEXTURE, fixed_uv + vec2( -shake_color_rate, 0.0 ), 0.0 ).b
    ,    enable_shift
    );
    COLOR = pixel_color;
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/shake_power = 0.03
shader_param/shake_rate = 0.2
shader_param/shake_speed = 5.0
shader_param/shake_block_size = 30.5
shader_param/shake_color_rate = 0.01

[node name="Main" type="ViewportContainer"]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 1
script = ExtResource( 13 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="Timer" type="Timer" parent="."]

[node name="TextureRect" type="TextureRect" parent="."]
margin_right = 40.0
margin_bottom = 40.0
texture = ExtResource( 9 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="Shortcuts" type="Control" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
script = ExtResource( 12 )
__meta__ = {
"_edit_lock_": true
}

[node name="Report" parent="Shortcuts" instance=ExtResource( 2 )]
margin_left = 47.2055
margin_top = 45.1908
margin_right = 47.2055
margin_bottom = 45.1908
_icon = ExtResource( 3 )
_window = ExtResource( 5 )
_label = "Report Writer"

[node name="Email" parent="Shortcuts" instance=ExtResource( 2 )]
margin_left = 46.0346
margin_top = 173.027
margin_right = 46.0346
margin_bottom = 173.027
_icon = ExtResource( 3 )
_window = ExtResource( 8 )
_label = "Gmail"
receive_notif = true

[node name="Notes" parent="Shortcuts" instance=ExtResource( 2 )]
margin_left = 46.0346
margin_top = 288.263
margin_right = 46.0346
margin_bottom = 288.263
_icon = ExtResource( 3 )
_window = ExtResource( 10 )
_label = "Notes"

[node name="*#&*%&¨*&$" parent="Shortcuts" instance=ExtResource( 2 )]
margin_left = 43.5791
margin_top = 398.76
margin_right = 43.5791
margin_bottom = 398.76
_icon = ExtResource( 3 )
_window = ExtResource( 10 )
_label = "*#&*%&¨*&$"

[node name="Thaum" parent="Shortcuts" instance=ExtResource( 2 )]
margin_left = 1038.21
margin_top = 37.4475
margin_right = 1038.21
margin_bottom = 37.4475
_icon = ExtResource( 3 )
_window = ExtResource( 10 )
_label = "Thaumaturgy Manual"

[node name="Cognitohazard" parent="Shortcuts" instance=ExtResource( 2 )]
margin_left = 1036.7
margin_top = 156.527
margin_right = 1036.7
margin_bottom = 156.527
_icon = ExtResource( 3 )
_window = ExtResource( 10 )
_label = "Transcript"

[node name="Misc" type="Control" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
__meta__ = {
"_edit_lock_": true
}

[node name="Username" type="Label" parent="Misc"]
margin_left = 883.0
margin_top = 625.0
margin_right = 1142.0
margin_bottom = 664.0
align = 2
valign = 2
script = ExtResource( 11 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="Timer" type="Timer" parent="Misc/Username"]
one_shot = true
autostart = true

[node name="Windows" type="Control" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
script = ExtResource( 4 )
__meta__ = {
"_edit_lock_": true
}
_window = ExtResource( 6 )

[node name="Taskbar" parent="." instance=ExtResource( 1 )]

[node name="MinigameSpawner" parent="." instance=ExtResource( 7 )]
visible = false
margin_left = 789.436
margin_top = -269.072
margin_right = -3.5636
margin_bottom = -32.0724

[node name="Cognitohazard" type="Control" parent="."]
visible = false
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2

[node name="Image" type="TextureRect" parent="Cognitohazard"]
anchor_right = 1.0
anchor_bottom = 1.0
margin_right = 1240.0
margin_bottom = 680.0
mouse_filter = 2
texture = ExtResource( 14 )

[node name="ColorRect" type="ColorRect" parent="Cognitohazard"]
material = SubResource( 2 )
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
__meta__ = {
"_edit_use_anchors_": false
}
[connection signal="timeout" from="Timer" to="." method="_on_Timer_timeout"]
[connection signal="ritual_activated" from="Shortcuts" to="." method="_on_Shortcuts_ritual_activated"]
[connection signal="clicked" from="Shortcuts/Report" to="Taskbar" method="add_program"]
[connection signal="clicked" from="Shortcuts/Email" to="Taskbar" method="add_program"]
[connection signal="clicked" from="Shortcuts/Notes" to="Taskbar" method="add_program"]
[connection signal="clicked" from="Shortcuts/*#&*%&¨*&$" to="Taskbar" method="add_program"]
[connection signal="clicked" from="Shortcuts/Thaum" to="Taskbar" method="add_program"]
[connection signal="clicked" from="Shortcuts/Cognitohazard" to="Taskbar" method="add_program"]
[connection signal="timeout" from="Misc/Username/Timer" to="Misc/Username" method="_on_Timer_timeout"]
[connection signal="closed_window" from="Windows" to="Taskbar" method="remove_program"]
[connection signal="minigame_failed" from="Windows" to="." method="_on_Windows_minigame_failed"]
[connection signal="updated_highlighted_window" from="Windows" to="Taskbar" method="highlight_program"]
[connection signal="create_window" from="Taskbar" to="Windows" method="_on_Taskbar_create_window"]
[connection signal="toggle_window" from="Taskbar" to="Windows" method="_on_Taskbar_toggle_window"]
[connection signal="spawn_minigame" from="MinigameSpawner" to="Taskbar" method="add_program"]
